<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta
        name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
        <link rel="stylesheet" href="style.css">

        <title>Account</title>

        <script src="https://gstatic.com/firebasejs/6.3.1/firebase-app.js"></script>
        <script src="https://gstatic.com/firebasejs/6.3.1/firebase-auth.js"></script>
        <script src="https://gstatic.com/firebasejs/6.3.1/firebase-database.js"></script>
        <script src="https://gstatic.com/firebasejs/6.3.1/firebase-storage.js"></script>

        <!-- jQuery first, then Popper.js, then Bootstrap JS -->
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>

        <script src="https://www.gstatic.com/firebasejs/5.9.4/firebase.js"></script>
        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/7.3.0/firebase-app.js"></script>

        <!-- TODO: Add SDKs for Firebase products that you want to use
                                                                                          https://firebase.google.com/docs/web/setup#available-libraries -->
        <!-- Add Firebase products that you want to use -->
        <script src="https://www.gstatic.com/firebasejs/6.1.1/firebase-auth.js"></script>

        <script src="https://www.gstatic.com/firebasejs/6.1.1/firebase-database.js"></script>
        <script src="https://www.gstatic.com/firebasejs/6.1.1/firebase-functions.js"></script>


        <script src="js/noOfBricks.js"></script>


        <script>
            // Your web app's Firebase configuration
            var firebaseConfig = {
                apiKey: "AIzaSyAjn39FIOAD4iH-KyFl6G5ygJjLCfxX6lM",
                authDomain: "hood-project-883de.firebaseapp.com",
                databaseURL: "https://hood-project-883de.firebaseio.com",
                projectId: "hood-project-883de",
                storageBucket: "hood-project-883de.appspot.com",
                messagingSenderId: "895762021353",
                appId: "1:895762021353:web:de05bbebaa562e44092978",
                measurementId: "G-TMSQNRF5DN"
            };
            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);
        </script>

        <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>

        <script src="./js/peopleEnteredGraph.js"></script>

        <script>
          
        </script>

        <script>
            // If user hasChild "participatesIn" - he joined a contest take him to the joinedContest.html else take him to invitation.html page.

            firebase.auth().onAuthStateChanged(function (user) {
                if (user) {
                    $("#buyBricks").click(function () {
                        window.location.href = "buyBricks.html";
                    });
                    
                    $("#requestBricks").click(function () {
                        window.location.href = "requestBricks.html";
                    });

                    $("#manageMyAccount").click(function () {
                        window.location.href = "manageAccount.html";
                    });

                    $("#dashboard").click(function () {
                        window.location.href = "inContestDashboard.html";
                    });


                    $("#withdrawMyBricks").click(function () {
                        window.location.href = "withdrawBricks.html";
                    });

                    $("#statsForNerds").click(function () {
                        window.location.href = "statsForNerds.html";
                    });


                    $("#joinContest").click(function () {
                        window.location.href = "joinContestClosed.html";
                    });


                }
            });

        </script>

    </head>
    <body
        onload="peopleEnteredCall(1)">
        <!-- <div class="sk-spinner sk-pulse"></div> -->
        <div class="">
            <div class="loader2">
                <br>
                <img src="./images/logos-08.png" alt="logo-brixy" height="120px">
                <img src="./images/brixy.net logo@2x.png" alt="brixyLogo-text" height="90px">
                <br>
                <img src="images/three-dots.svg" alt="three-dots" height="25px">
            </div>
            <!--Navigation Menu-->
            <section id="nav_bar">
                <nav-bar-elem></nav-bar-elem>
            </section>

            <brick-layer></brick-layer>

            <section>
                <div class="container">
                    <div class="gapp"></div>
                    <div class="row">

                        <div class="col-md-7 col-md-pull-7 text-center order-sm-6">
                            <div class="card text-center">
                                <div
                                    class="card-body">
                                    <!-- <h3 class="card-title">CURRENT MARKET POOL RAISED:</h3> -->
                                    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
                                    <h3 id="word" class="card-title">BRICKS RAISED BRONZE CYCLE</h3>
                                    <p class="card-text money" id="moneyRaised">Loading...</p>
                                    <div class="left" id="left"></div>
                                    <div class="right" id="right"></div>
                                </div>
                            </div>

                            <div class="gap"></div>

                            <div class="card text-center" id="graphSection">
                                <div class="card-body">
                                    <h3 class="card-title">
                                        <span id="cat">BRONZE</span>
                                        CYCLE</h3>

                                    <canvas id="peopleEntered10" class="canvasLogged" width="400" height="200"></canvas>

                                    <div class="left" id="leftGraph"></div>
                                    <div class="right" id="rightGraph"></div>
                                </div>

                            </div>

                        </div>

                        <div class="col-md-5 col-md-push-5 order-sm-1">

                            <!-- <button type="button" class="btn btn-new" id="buyBricks">Buy Bricks</button> -->
                            <button type="button" class="btn btn-new" id="requestBricks">Get Bricks</button>
                            <button type="button" class="btn btn-new" id="joinContest">Join a Cycle</button>
                            <button type="button" class="btn btn-new" id="dashboard" style="display:none;">Dashboard</button>
                            <button type="button" class="btn btn-new" id="statsForNerds">Statistics</button>
                            <button type="button" class="btn btn-new" id="manageMyAccount">Manage my account</button>
                            <button type="button" class="btn btn-new" id="withdrawMyBricks">Withdraw Bricks</button>

                        </div>

                    </div>
                </div>
            </section>

            <!-- <div class="gapp"></div> -->

            <section id="#footer">
                <img src="./images/loggedIn_outline.svg" style="width: 100%; margin-top: 0px;"/>
            </section>
            <script>
                $(function () { // firebase.database().ref('/Contests/Pool1').child("moneySpread").once('value').then(function(snapshot) {
                    firebase.database().ref('/Contests').once('value').then(function (snapshot) { // var username = (snapshot.val() && snapshot.val().username) || 'Anonymous';
                        var moneySpread = snapshot.child("Pool1").child("moneySpread").val();
                        var moneySpread2 = snapshot.child("Pool2").child("moneySpread").val();
                        var moneySpread3 = snapshot.child("Pool3").child("moneySpread").val();
                        console.log(moneySpread);

                        $("#moneyRaised").html(moneySpread + " Bricks");

                        count = 0;
                        // wordsArray = ["BRICKS RAISED POOL1", "BRICKS RAISED POOL2", "BRICKS RAISED POOL3"];
                        arrayMarket = [moneySpread, moneySpread2, moneySpread3];


                        count = 0;
                        categoryArray = ["BRONZE", "SILVER", "GOLD"];
                        wordsArray = ["BRICKS RAISED BRONZE CYCLE", "BRICKS RAISED SILVER CYCLE", "BRICKS RAISED GOLD CYCLE"];
                        setInterval(function () {
                            count ++;
                            $("#word").fadeOut(400, function () {
                                $(this).text(wordsArray[count % wordsArray.length]).fadeIn(400);
                            });

                            $("#cat").fadeOut(400, function () {
                                $(this).text(categoryArray[count % categoryArray.length]).fadeIn(400);
                                peopleEnteredCall((count % categoryArray.length) + 1);
                            });

                            $("#moneyRaised").fadeOut(400, function () {
                                $(this).text(arrayMarket[count % arrayMarket.length] + " Bricks").fadeIn(400);
                            });

                        }, 60000);


                    });

                });
            </script>


            <script>
                firebase.auth().onAuthStateChanged(function (user) {
                    if (user) {
                        var userId = user.uid;
                        firebase.database().ref('/profiles/').child(userId).once('value').then(function (snapshot) {
                            if (snapshot.hasChild("participates")) {
                                $("#dashboard").css("display", "block");
                                $(".loader2").fadeOut("slow");
                            } else {
                                $(".loader2").fadeOut("slow");
                            }
                        });
                    }
                });
            </script>

            <script>
                firebase.database().ref('/Contests').once('value').then(function (snapshot) { // var username = (snapshot.val() && snapshot.val().username) || 'Anonymous';
                    var moneySpread = snapshot.child("Pool1").child("moneySpread").val();
                    var moneySpread2 = snapshot.child("Pool2").child("moneySpread").val();
                    var moneySpread3 = snapshot.child("Pool3").child("moneySpread").val();
                    console.log(moneySpread);

                    $("#moneyRaised").html(moneySpread + " Bricks");

                    count = 0;
                    // wordsArray = ["BRICKS RAISED POOL1", "BRICKS RAISED POOL2", "BRICKS RAISED POOL3"];
                    arrayMarket = [moneySpread, moneySpread2, moneySpread3];

                    var counter = 0;
                    var counterGraph = 0;
                    categoryArray = ["BRONZE", "SILVER", "GOLD"];
                    wordsArray = ["BRICKS RAISED BRONZE CYCLE", "BRICKS RAISED SILVER CYCLE", "BRICKS RAISED GOLD CYCLE"];


                    $("#left").click(function () {
                        console.log("clicked");
                        counter--;
                        if (counter < 0) {
                            counter = 2;
                        }

                        change(counter);
                    });


                    $("#right").click(function () {
                        console.log("clicked");
                        counter++;
                        if (counter === 3) {
                            counter = 0;
                        }

                        change(counter);
                    });


                    $("#leftGraph").click(function () {
                        console.log("clicked");
                        counterGraph--;
                        if (counterGraph < 0) {
                            counterGraph = 2;
                        }

                        changeGraph(counterGraph);
                    });


                    $("#rightGraph").click(function () {
                        console.log("clicked");
                        counterGraph++;
                        if (counterGraph === 3) {
                            counterGraph = 0;
                        }

                        changeGraph(counterGraph);
                    });


                    function change(counter) {
                        $("#word").fadeOut(400, function () {
                            $(this).text(wordsArray[counter]).fadeIn(400);
                        });

                        $("#moneyRaised").fadeOut(400, function () {
                            $(this).text(arrayMarket[counter] + " Bricks").fadeIn(400);
                        });

                    }

                    function changeGraph(counter) {
                        $("#cat").fadeOut(400, function () {
                            $(this).text(categoryArray[counter]).fadeIn(400);
                            peopleEnteredCall((counter) + 1);
                        });

                    }

                });
            </script>


        </div>
        <script src="brickLayer.js"></script>
        <script src="navbar.js"></script>
    </body>
</html>
